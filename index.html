<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Studio</title>
    <link rel="icon" type="image/x-icon" href="favicon.svg">
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        neutral: {
                            50: '#fafaf9',
                            100: '#f5f5f4',
                            800: '#292524',
                            900: '#1c1917',
                        },
                        brand: {
                            light: '#e7e5e4', // Warm grey
                            DEFAULT: '#44403c', // Stone 700
                            dark: '#0c0a09', // Stone 950
                            accent: '#ea580c', // Orange 600
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Fira Code', 'monospace'],
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #d6d3d1;
            border-radius: 4px;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #44403c;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a29e;
        }
        
        /* Chart Container Specifics */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 100%;
            height: 250px;
            margin-left: auto;
            margin-right: auto;
        }
        @media (min-width: 1024px) {
            .chart-container {
                height: 200px;
            }
        }

        /* Editor Styles */
        textarea {
            resize: none;
            outline: none;
        }

        /* Icon alignment fix */
        .material-symbols-outlined {
            font-size: 20px;
            vertical-align: middle;
        }

        /* Button Active State helper */
        .btn-active {
            color: #ea580c; /* brand-accent */
            background-color: #f5f5f4;
        }
        .dark .btn-active {
            background-color: #292524;
        }
    </style>
</head>
<body class="bg-neutral-50 text-neutral-800 dark:bg-neutral-900 dark:text-neutral-100 transition-colors duration-300 h-screen flex flex-col overflow-hidden font-sans">

    <!-- Header / Navigation -->
    <header class="h-16 border-b border-neutral-200 dark:border-neutral-800 flex items-center justify-between px-4 sm:px-6 bg-white dark:bg-neutral-900 shrink-0 z-10 shadow-sm transition-colors duration-300">
        
        <!-- Left: Logo -->
        <div class="flex items-center gap-3">
            <div class="w-8 h-8  rounded-lg flex items-center justify-center text-white shadow-lg">
                <img src="favicon.svg" alt="Logo" class="w-5 h-5">
            </div>
            <h1 class="text-lg font-bold tracking-tight hidden lg:block">Markdown Studio</h1>
        </div>

        <!-- Center: View Controls -->
        <div class="flex items-center bg-neutral-100 dark:bg-neutral-800 rounded-lg p-1 gap-1">
            <!-- Toggle Editor -->
            <button id="btn-view-editor" class="p-1.5 rounded hover:bg-white dark:hover:bg-neutral-700 transition-colors text-neutral-500 dark:text-neutral-400" title="Toggle Editor">
                <span class="material-symbols-outlined">dock_to_left</span>
            </button>
            
            <!-- Toggle Preview -->
            <button id="btn-view-preview" class="p-1.5 rounded hover:bg-white dark:hover:bg-neutral-700 transition-colors text-neutral-500 dark:text-neutral-400" title="Toggle Preview">
                <span class="material-symbols-outlined">dock_to_right</span>
            </button>

            <div class="w-px h-4 bg-neutral-300 dark:bg-neutral-600 mx-1"></div>

            <!-- Toggle Sync Scroll -->
            <button id="btn-sync-scroll" class="p-1.5 rounded hover:bg-white dark:hover:bg-neutral-700 transition-colors text-neutral-500 dark:text-neutral-400" title="Toggle Sync Scroll">
                <span id="icon-sync" class="material-symbols-outlined">sync_lock</span>
            </button>
        </div>

        <!-- Right: Actions -->
        <div class="flex items-center gap-2 sm:gap-4">
            <!-- Stats Toggle -->
            <button id="btn-stats" class="text-sm font-medium hover:text-brand-accent transition-colors flex items-center gap-2">
                <span class="material-symbols-outlined">analytics</span> 
                <span class="hidden sm:inline">Analytics</span>
            </button>
            
            <div class="h-6 w-px bg-neutral-200 dark:bg-neutral-700 hidden sm:block"></div>

            <!-- File Controls (Icons on mobile) -->
            <label class="cursor-pointer text-sm font-medium hover:text-brand-accent transition-colors flex items-center gap-2">
                <span class="material-symbols-outlined">folder_open</span>
                <span class="hidden sm:inline">Open</span>
                <input type="file" id="file-input" class="hidden" accept=".md,.txt,.markdown">
            </label>
            
            <button id="btn-save" class="text-sm font-medium hover:text-brand-accent transition-colors flex items-center gap-2">
                <span class="material-symbols-outlined">save</span>
                <span class="hidden sm:inline">Save</span>
            </button>

            <div class="h-6 w-px bg-neutral-200 dark:bg-neutral-700"></div>

            <!-- Theme Toggle -->
            <button id="btn-theme" class="w-8 h-8 flex items-center justify-center hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-md transition-colors text-neutral-600 dark:text-neutral-400">
                <span class="material-symbols-outlined">light_mode</span>
            </button>
        </div>
    </header>

    <!-- Main Workspace -->
    <main class="flex-1 flex overflow-hidden relative">
        
        <!-- Editor Section -->
        <section id="section-editor" class="flex-1 flex flex-col min-w-0 border-r border-neutral-200 dark:border-neutral-800 transition-colors duration-300">
            <div class="h-10 bg-neutral-100 dark:bg-neutral-800 border-b border-neutral-200 dark:border-neutral-700 flex items-center justify-between px-4 shrink-0">
                <span class="text-xs font-bold uppercase tracking-wider text-neutral-500 flex items-center gap-1">
                    <span class="material-symbols-outlined text-[16px]">code</span> Editor
                </span>
                <span class="text-xs text-neutral-400" id="char-count">0 chars</span>
            </div>
            <textarea id="editor" class="flex-1 w-full p-6 bg-neutral-50 dark:bg-[#1e1e1e] text-neutral-800 dark:text-neutral-200 font-mono text-sm leading-relaxed border-none focus:ring-0" spellcheck="false" placeholder="# Start writing..."></textarea>
        </section>

        <!-- Preview Section -->
        <section id="section-preview" class="flex-1 flex flex-col min-w-0 bg-white dark:bg-neutral-900 transition-colors duration-300">
            <div class="h-10 bg-white dark:bg-neutral-900 border-b border-neutral-200 dark:border-neutral-800 flex items-center justify-between px-4 shrink-0">
                <span class="text-xs font-bold uppercase tracking-wider text-neutral-500 flex items-center gap-1">
                    <span class="material-symbols-outlined text-[16px]">visibility</span> Preview
                </span>
                <span class="text-xs text-neutral-400">Live Render</span>
            </div>
            <div id="preview" class="flex-1 w-full p-8 overflow-y-auto prose prose-stone dark:prose-invert max-w-none scroll-smooth">
                <!-- Content injected here -->
            </div>
        </section>

        <!-- Analytics Sidebar (Collapsible) -->
        <aside id="analytics-panel" class="w-80 bg-neutral-50 dark:bg-neutral-900 border-l border-neutral-200 dark:border-neutral-800 flex flex-col transform transition-transform duration-300 absolute right-0 top-0 bottom-0 z-20 translate-x-full shadow-xl">
            
            <div class="h-10 bg-neutral-100 dark:bg-neutral-800 border-b border-neutral-200 dark:border-neutral-700 flex items-center justify-between px-4 shrink-0">
                <span class="text-xs font-bold uppercase tracking-wider text-neutral-500 flex items-center gap-1">
                    <span class="material-symbols-outlined text-[16px]">monitoring</span> Analytics
                </span>
                <button id="close-stats" class="text-neutral-500 hover:text-red-500">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>

            <div class="p-4 space-y-6 overflow-y-auto flex-1">
                <p class="text-xs text-neutral-500 italic mb-4 flex items-start gap-2">
                    <span class="material-symbols-outlined text-sm mt-0.5">info</span>
                    Real-time analysis of your document structure and readability.
                </p>

                <!-- Chart 1: Composition -->
                <div class="bg-white dark:bg-neutral-800 p-4 rounded-lg shadow-sm border border-neutral-200 dark:border-neutral-700">
                    <h3 class="text-xs font-bold text-neutral-700 dark:text-neutral-300 mb-2">Content Composition</h3>
                    <div class="chart-container">
                        <canvas id="compositionChart"></canvas>
                    </div>
                </div>

                <!-- Chart 2: Reading Time -->
                <div class="bg-white dark:bg-neutral-800 p-4 rounded-lg shadow-sm border border-neutral-200 dark:border-neutral-700">
                    <h3 class="text-xs font-bold text-neutral-700 dark:text-neutral-300 mb-2">Est. Reading Time (min)</h3>
                    <div class="chart-container">
                        <canvas id="readingTimeChart"></canvas>
                    </div>
                    <div class="mt-2 text-center">
                        <span id="avg-read-time" class="text-2xl font-bold text-brand-accent">0</span>
                        <span class="text-xs text-neutral-400">min avg</span>
                    </div>
                </div>

                <!-- Simple Stats Grid -->
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-white dark:bg-neutral-800 p-3 rounded-lg border border-neutral-200 dark:border-neutral-700 text-center">
                        <div id="stat-words" class="text-xl font-bold text-neutral-800 dark:text-neutral-100">0</div>
                        <div class="text-[10px] uppercase text-neutral-400 tracking-wide">Words</div>
                    </div>
                    <div class="bg-white dark:bg-neutral-800 p-3 rounded-lg border border-neutral-200 dark:border-neutral-700 text-center">
                        <div id="stat-paragraphs" class="text-xl font-bold text-neutral-800 dark:text-neutral-100">0</div>
                        <div class="text-[10px] uppercase text-neutral-400 tracking-wide">Paragraphs</div>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <script>
        /**
         * DEFAULT CONTENT
         */
        const defaultContent = `# Project Antigravity: SyncScroll Edition

## 1. Executive Summary
**Antigravity** is a lightweight, zero-dependency environment for editing and visualizing Markdown content. Designed with a focus on cognitive clarity, it bridges the gap between raw syntax and visual presentation.

## 2. Technical Architecture
The application runs entirely in the browser (Client-Side).
* **Core Engine:** Vanilla JavaScript (ES6+).
* **Rendering:** \`marked.js\` parser for high-performance AST compilation.
* **Styling:** Tailwind CSS for a utility-first, responsive design system.
* **Analytics:** \`Chart.js\` for dynamic text visualization.

## 3. Key Features
* **SyncScroll:** Editor and Preview scroll together automatically. Try scrolling this side!
* **View Controls:** Toggle Editor or Preview tabs using the icons in the top bar.
* **Real-time Parsing:** Instant feedback loop between editor and preview.
* **Adaptive Theming:** System-aware Dark/Light mode integration.
* **Data Visualization:** Live charts analyzing text density and reading difficulty.

## 4. Usage Guide
1.  **Write:** Type Markdown on the left.
2.  **View:** See the result on the right.
3.  **Analyze:** Check the right sidebar for live metrics.
4.  **Export:** Click the "Save" icon to download your \`.md\` file.

`;

        // State
        const state = {
            content: defaultContent,
            isDark: false,
            statsOpen: false,
            syncScroll: true,
            showEditor: true,
            showPreview: true
        };

        // DOM Elements
        const editor = document.getElementById('editor');
        const preview = document.getElementById('preview');
        const sectionEditor = document.getElementById('section-editor');
        const sectionPreview = document.getElementById('section-preview');
        
        const btnTheme = document.getElementById('btn-theme');
        const btnStats = document.getElementById('btn-stats');
        const btnCloseStats = document.getElementById('close-stats');
        const panelStats = document.getElementById('analytics-panel');
        const fileInput = document.getElementById('file-input');
        const btnSave = document.getElementById('btn-save');
        const charCountEl = document.getElementById('char-count');

        // View Control Buttons
        const btnViewEditor = document.getElementById('btn-view-editor');
        const btnViewPreview = document.getElementById('btn-view-preview');
        const btnSyncScroll = document.getElementById('btn-sync-scroll');
        const iconSync = document.getElementById('icon-sync');
        
        // Chart Instances
        let compositionChartInstance = null;
        let readingTimeChartInstance = null;

        // Initialization
        function init() {
            // Load content
            editor.value = state.content;
            
            // Initial render
            updatePreview();
            
            // Theme check
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                toggleTheme(true);
            } else {
                toggleTheme(false);
            }

            // View Mode Check (Mobile defaults to Editor only)
            if (window.innerWidth < 768) {
                state.showPreview = false;
            }
            applyViewMode();

            // Init Charts
            initCharts();
            updateStats();
        }

        // --- Logic: Markdown & Preview ---
        
        function updatePreview() {
            const raw = editor.value;
            state.content = raw;
            
            // Parse Markdown
            preview.innerHTML = marked.parse(raw);
            
            // Update Char Count
            charCountEl.textContent = `${raw.length} chars`;

            // Update Stats
            updateStats();
        }

        editor.addEventListener('input', updatePreview);

        // --- Logic: Sync Scroll ---
        
        let isSyncingLeft = false;
        let isSyncingRight = false;

        editor.addEventListener('scroll', () => {
            if (!state.syncScroll || isSyncingLeft) return;
            isSyncingRight = true;
            
            // Calculate percentage
            const percentage = editor.scrollTop / (editor.scrollHeight - editor.clientHeight);
            // Apply to preview
            preview.scrollTop = percentage * (preview.scrollHeight - preview.clientHeight);
            
            setTimeout(() => { isSyncingRight = false; }, 50);
        });

        preview.addEventListener('scroll', () => {
            if (!state.syncScroll || isSyncingRight) return;
            isSyncingLeft = true;

            // Calculate percentage
            const percentage = preview.scrollTop / (preview.scrollHeight - preview.clientHeight);
            // Apply to editor
            editor.scrollTop = percentage * (editor.scrollHeight - editor.clientHeight);

            setTimeout(() => { isSyncingLeft = false; }, 50);
        });

        // Toggle Sync Button
        btnSyncScroll.addEventListener('click', () => {
            state.syncScroll = !state.syncScroll;
            if (state.syncScroll) {
                iconSync.innerText = 'sync_lock';
                btnSyncScroll.classList.add('btn-active');
            } else {
                iconSync.innerText = 'sync_disabled';
                btnSyncScroll.classList.remove('btn-active');
            }
        });

        // --- Logic: View Modes (Hide/Show Tabs) ---

        function applyViewMode() {
            // Manage Editor Visibility
            if (state.showEditor) {
                sectionEditor.classList.remove('hidden');
                btnViewEditor.classList.add('btn-active');
            } else {
                sectionEditor.classList.add('hidden');
                btnViewEditor.classList.remove('btn-active');
            }

            // Manage Preview Visibility
            if (state.showPreview) {
                sectionPreview.classList.remove('hidden');
                btnViewPreview.classList.add('btn-active');
            } else {
                sectionPreview.classList.add('hidden');
                btnViewPreview.classList.remove('btn-active');
            }
        }

        btnViewEditor.addEventListener('click', () => {
            if (state.showEditor && !state.showPreview) return; // Prevent hiding both
            state.showEditor = !state.showEditor;
            applyViewMode();
        });

        btnViewPreview.addEventListener('click', () => {
            if (state.showPreview && !state.showEditor) return; // Prevent hiding both
            state.showPreview = !state.showPreview;
            applyViewMode();
        });

        // --- Logic: Theming ---

        function toggleTheme(forceDark = null) {
            const html = document.documentElement;
            const isDarkNext = forceDark !== null ? forceDark : !html.classList.contains('dark');
            
            if (isDarkNext) {
                html.classList.add('dark');
                btnTheme.innerHTML = '<span class="material-symbols-outlined">dark_mode</span>'; 
                state.isDark = true;
            } else {
                html.classList.remove('dark');
                btnTheme.innerHTML = '<span class="material-symbols-outlined">light_mode</span>';
                state.isDark = false;
            }
            
            // Update Charts Theme
            updateChartsTheme();
        }

        btnTheme.addEventListener('click', () => toggleTheme());

        // --- Logic: File I/O ---

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                editor.value = e.target.result;
                updatePreview();
            };
            reader.readAsText(file);
        });

        btnSave.addEventListener('click', () => {
            const blob = new Blob([editor.value], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'document.md';
            a.click();
            URL.revokeObjectURL(url);
        });

        // --- Logic: Analytics (Chart.js) ---

        function initCharts() {
            const ctxComp = document.getElementById('compositionChart').getContext('2d');
            const ctxRead = document.getElementById('readingTimeChart').getContext('2d');

            const commonOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                }
            };

            // Donut Chart: Composition
            compositionChartInstance = new Chart(ctxComp, {
                type: 'doughnut',
                data: {
                    labels: ['Words', 'Space/Punctuation'],
                    datasets: [{
                        data: [50, 50],
                        backgroundColor: ['#ea580c', '#e7e5e4'],
                        borderWidth: 0
                    }]
                },
                options: {
                    ...commonOptions,
                    cutout: '70%',
                }
            });

            // Bar Chart: Reading Speeds
            readingTimeChartInstance = new Chart(ctxRead, {
                type: 'bar',
                data: {
                    labels: ['Fast', 'Avg', 'Deep'],
                    datasets: [{
                        label: 'Minutes',
                        data: [1, 2, 3],
                        backgroundColor: '#ea580c',
                        borderRadius: 4
                    }]
                },
                options: {
                    ...commonOptions,
                    scales: {
                        y: { beginAtZero: true, display: false },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        function updateStats() {
            const text = state.content;
            
            // 1. Text Analysis
            const wordCount = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
            const charCount = text.length;
            const paragraphCount = text.split(/\n\n+/).filter(t => t.trim().length > 0).length;

            // Update Text Stats
            document.getElementById('stat-words').textContent = wordCount;
            document.getElementById('stat-paragraphs').textContent = paragraphCount;

            // 2. Chart Update: Composition
            if (compositionChartInstance) {
                const wordMass = (text.match(/\w/g) || []).length;
                const otherMass = charCount - wordMass;
                
                compositionChartInstance.data.datasets[0].data = [wordMass, otherMass];
                compositionChartInstance.update();
            }

            // 3. Chart Update: Reading Time
            // Avg reading speed ~238 wpm. Fast ~400. Deep/Technical ~150.
            const minAvg = (wordCount / 238).toFixed(1);
            const minFast = (wordCount / 400).toFixed(1);
            const minDeep = (wordCount / 150).toFixed(1);

            document.getElementById('avg-read-time').textContent = minAvg;

            if (readingTimeChartInstance) {
                readingTimeChartInstance.data.datasets[0].data = [minFast, minAvg, minDeep];
                readingTimeChartInstance.update();
            }
        }

        function updateChartsTheme() {
            const isDark = state.isDark;
            const labelColor = isDark ? '#d6d3d1' : '#44403c';
            const secondaryColor = isDark ? '#292524' : '#e7e5e4';

            if (compositionChartInstance) {
                compositionChartInstance.data.datasets[0].backgroundColor = ['#ea580c', secondaryColor];
                compositionChartInstance.update();
            }

            if (readingTimeChartInstance) {
                readingTimeChartInstance.options.scales.x.ticks = { color: labelColor };
                readingTimeChartInstance.update();
            }
        }

        // --- Logic: Analytics Panel Toggle ---
        
        btnStats.addEventListener('click', () => {
            panelStats.classList.toggle('translate-x-full');
            state.statsOpen = !state.statsOpen;
        });
        
        btnCloseStats.addEventListener('click', () => {
            panelStats.classList.add('translate-x-full');
            state.statsOpen = false;
        });

        // Run
        init();

    </script>
</body>
</html>
